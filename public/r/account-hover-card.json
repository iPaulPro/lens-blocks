{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "account-hover-card",
  "type": "registry:block",
  "title": "Lens Account Hover Card",
  "description": "A hover card that displays Lens account details when hovering over an account name or handle.",
  "dependencies": [
    "@lens-protocol/react@0.0.0-canary-20250820102520",
    "@lens-protocol/client@0.0.0-canary-20250820102520",
    "lucide-react",
    "viem@2.33.0"
  ],
  "registryDependencies": [
    "avatar",
    "hover-card",
    "skeleton",
    "@lens-blocks/follow-button",
    "@lens-blocks/lens-markdown",
    "@lens-blocks/utils"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/lens-account-hover-card.tsx",
      "content": "\"use client\";\n\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/registry/new-york/ui/avatar\";\nimport { HoverCard, HoverCardContent, HoverCardTrigger } from \"@/registry/new-york/ui/hover-card\";\nimport { ReactNode, useEffect, useState } from \"react\";\nimport { Account, AccountStats, PublicClient, SessionClient, TxHash } from \"@lens-protocol/react\";\nimport { fetchAccount, fetchAccountStats } from \"@lens-protocol/client/actions\";\nimport { formatFollowerCount, parseUri } from \"@/registry/new-york/lib/lens-utils\";\nimport { CircleUserRoundIcon } from \"lucide-react\";\nimport { WalletClient } from \"viem\";\nimport LensMarkdown from \"@/registry/new-york/components/common/lens-markdown\";\nimport LensFollowButton from \"@/registry/new-york/components/account/lens-follow-button\";\n\ninterface Props {\n  /**\n   * The component that will trigger the hover card when hovered over.\n   *\n   */\n  children?: ReactNode;\n\n  /**\n   * The Lens Account to display information about\n   */\n  account: Account;\n\n  /**\n   * The Lens Client used for making public and authenticated calls\n   */\n  lensClient: PublicClient | SessionClient;\n\n  /**\n   * The wallet client from viem used to sign messages for authentication.\n   * If not provided, follow/unfollow button will not be rendered.\n   */\n  walletClient?: WalletClient;\n\n  /**\n   * Callback function that is called when the follow operation is successful\n   */\n  onFollowSuccess?: (account: Account, txHash: TxHash) => void;\n\n  /**\n   * Callback function that is called when the unfollow operation is successful\n   */\n  onUnfollowSuccess?: (account: Account, txHash: TxHash) => void;\n\n  /**\n   * Callback function that is called when an error occurs during follow/unfollow operations\n   */\n  onError?: (account: Account, error: Error) => void;\n}\n\nexport default function LensAccountHoverCard(props: Props) {\n  const { children, account, lensClient, walletClient, onFollowSuccess, onUnfollowSuccess, onError } = props;\n\n  const session = lensClient?.isSessionClient() ? (lensClient as SessionClient) : null;\n\n  const [isOpen, setIsOpen] = useState(false);\n  const [accountStats, setAccountStats] = useState<AccountStats>();\n  const [showFollowButton, setShowFollowButton] = useState(false);\n  const [freshAccount, setFreshAccount] = useState<Account>(account);\n\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const fetchStats = async () => {\n      const res = await fetchAccountStats(lensClient, {\n        account: account.address,\n      });\n      if (res.isOk() && res.value) {\n        setAccountStats(res.value);\n      }\n    };\n\n    fetchStats();\n\n    if (!session) return;\n\n    const user = session.getAuthenticatedUser();\n    if (user.isOk()) {\n      setShowFollowButton(\n        freshAccount.operations?.canFollow.__typename === \"AccountFollowOperationValidationPassed\" ||\n          freshAccount.operations?.canUnfollow.__typename === \"AccountFollowOperationValidationPassed\",\n      );\n    }\n  }, [account, isOpen]);\n\n  const updateAccount = async () => {\n    const client = session ?? lensClient;\n    const res = await fetchAccount(client, {\n      address: account.address,\n    });\n    if (res.isOk() && res.value) {\n      setFreshAccount(res.value);\n    }\n  };\n\n  const handleFollowSuccess = async (txHash: TxHash) => {\n    await updateAccount();\n    onFollowSuccess?.(freshAccount, txHash);\n  };\n\n  const handleUnfollowSuccess = async (txHash: TxHash) => {\n    await updateAccount();\n    onUnfollowSuccess?.(freshAccount, txHash);\n  };\n\n  return (\n    <HoverCard open={isOpen} onOpenChange={setIsOpen}>\n      <HoverCardTrigger>{children}</HoverCardTrigger>\n      <HoverCardContent className=\"w-80\">\n        <div className=\"flex flex-col w-full min-w-0\">\n          <div className=\"flex justify-between\">\n            <Avatar className=\"w-10 h-10\">\n              <AvatarImage\n                src={parseUri(freshAccount.metadata?.picture)}\n                alt={\"@\" + freshAccount.username?.localName}\n              />\n              <AvatarFallback className=\"bg-primary\">\n                <CircleUserRoundIcon className=\"text-primary-foreground\" />\n              </AvatarFallback>\n            </Avatar>\n            {showFollowButton && (\n              <LensFollowButton\n                account={account}\n                session={session}\n                walletClient={walletClient}\n                onFollowSuccess={(_account, txHash) => handleFollowSuccess(txHash)}\n                onUnfollowSuccess={(_account, txHash) => handleUnfollowSuccess(txHash)}\n                onFollowError={onError}\n              />\n            )}\n          </div>\n          <div className=\"flex flex-col pt-2 w-full min-w-0\">\n            <div className=\"font-bold text-lg truncate\">\n              {freshAccount.metadata?.name ??\n                (freshAccount.username ? \"@\" + freshAccount.username.value.replace(\"lens/\", \"\") : undefined) ??\n                freshAccount.address}\n            </div>\n            <div className=\"flex flex-wrap gap-2 items-center -mt-0.5\">\n              {freshAccount.metadata?.name && freshAccount.username && (\n                <span className=\"opacity-60 truncate\">{`@${freshAccount.username.value.replace(\"lens/\", \"\")}`}</span>\n              )}\n              {freshAccount.operations?.isFollowingMe && (\n                <span className=\"h-5 bg-muted text-muted-foreground rounded-full px-2 text-xs font-semibold flex items-center justify-center\">\n                  Follows you\n                </span>\n              )}\n            </div>\n            {freshAccount.metadata?.bio && (\n              <LensMarkdown content={freshAccount.metadata.bio} className=\"opacity-70 pt-3 pb-1 line-clamp-5 text-sm\" />\n            )}\n            {accountStats && (\n              <div className=\"flex gap-3 pt-2 text-sm\">\n                <div className=\"flex gap-1\">\n                  <span className=\"font-bold\">{formatFollowerCount(accountStats.graphFollowStats.following)}</span>\n                  <span className=\"opacity-60\">following</span>\n                </div>\n                <div className=\"flex gap-1\">\n                  <span className=\"font-bold\">{formatFollowerCount(accountStats.graphFollowStats.followers)}</span>\n                  <span className=\"opacity-60\">followers</span>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </HoverCardContent>\n    </HoverCard>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}
