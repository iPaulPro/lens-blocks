{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "link-preview",
  "type": "registry:component",
  "title": "Link Preview",
  "description": "A component to display a link preview for URLs included in Lens posts, showing the title, description, and image.",
  "dependencies": ["linkedom@0.18.12"],
  "files": [
    {
      "path": "registry/new-york/components/feed/link-preview.tsx",
      "content": "import { useEffect, useState } from \"react\";\nimport getMetaFromUrl, { UrlMetadata } from \"@/registry/new-york/lib/get-meta-from-url\";\nimport getFavicon from \"@/registry/new-york/lib/get-favicon\";\n\ntype Props = {\n  url: string;\n};\n\nexport const LinkPreview = (props: Props) => {\n  const { url } = props;\n\n  const [urlMetadata, setUrlMetadata] = useState<UrlMetadata | null>(null);\n\n  const favicon = getFavicon(url);\n\n  useEffect(() => {\n    if (!url) return;\n    getMetaFromUrl({ url }).then(setUrlMetadata);\n  }, [url]);\n\n  if (!urlMetadata) {\n    return null;\n  }\n\n  return (\n    <div onClick={event => event.stopPropagation()}>\n      <a\n        href={url}\n        className=\"w-full max-w-sm flex flex-col bg-card text-card-foreground border rounded-lg mb-4 cursor-pointer hover:!no-underline\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n      >\n        <div className=\"flex flex-col p-2 flex-1 min-w-0 gap-0.5\">\n          <div className=\"flex gap-1 items-center\">\n            <img\n              src={urlMetadata.icon ?? favicon}\n              width={24}\n              height={24}\n              alt={`${url} favicon`}\n              className=\"w-4 h-4 p-0.5\"\n            />\n            <div className=\"line-clamp-1 opacity-60 text-xs font-normal\">\n              {urlMetadata.siteName ? urlMetadata.siteName + \" â€¢ \" : \"\"}\n              {urlMetadata.url}\n            </div>\n          </div>\n          {urlMetadata.title && <div className=\"line-clamp-1 !font-bold text-sm\">{urlMetadata.title}</div>}\n          {urlMetadata.description && (\n            <div className=\"line-clamp-2 text-xs !font-normal\">{urlMetadata.description}</div>\n          )}\n        </div>\n      </a>\n    </div>\n  );\n};\n",
      "type": "registry:component"
    },
    {
      "path": "registry/new-york/lib/get-meta-from-url.ts",
      "content": "import { parseHTML } from \"linkedom\";\n\nexport type UrlMetadata = {\n  url: string;\n  title: string | null;\n  description: string | null;\n  siteName: string | null;\n  icon: string | null;\n};\n\ntype Props = {\n  url: string;\n  userAgent?: string;\n};\n\nconst getContentFromMetaTag = (document: Document, name: string): string | undefined | null => {\n  const metaTag = document.querySelector(`meta[name=\"${name}\"]`) || document.querySelector(`meta[property=\"${name}\"]`);\n  return metaTag?.getAttribute(\"content\");\n};\n\nexport default async function getMetaFromUrl(props: Props) {\n  const { url, userAgent = \"LensBot/0.1 (like TwitterBot)\" } = props;\n\n  const response = await fetch(url, {\n    headers: { \"User-Agent\": userAgent },\n  });\n\n  if (!response.ok) {\n    return { url, title: null, description: null } as UrlMetadata;\n  }\n\n  const data = await response.text();\n  const { document } = parseHTML(data);\n\n  const title = getContentFromMetaTag(document, \"og:title\") || getContentFromMetaTag(document, \"twitter:title\") || null;\n\n  const description =\n    getContentFromMetaTag(document, \"og:description\") || getContentFromMetaTag(document, \"twitter:description\") || null;\n\n  const siteName = getContentFromMetaTag(document, \"og:site_name\") || null;\n\n  const iconLinkTag = document.querySelector(`link[rel=\"icon\"]`);\n  let icon = iconLinkTag?.getAttribute(\"href\");\n  if (icon?.startsWith(\"/\")) {\n    const urlObj = new URL(url);\n    const absoluteUrl = `${urlObj.protocol}//${urlObj.host}${icon}`;\n    icon = absoluteUrl;\n  }\n\n  return { url, title, description, siteName, icon } as UrlMetadata;\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/new-york/lib/get-favicon.ts",
      "content": "const FAVICON_BASE_URL = \"https://external-content.duckduckgo.com/ip3\";\nconst UNKNOWN_DOMAIN = \"unknowndomain\";\n\nconst getFavicon = (url: string): string => {\n  const domain = (() => {\n    try {\n      return new URL(url).hostname;\n    } catch {\n      return UNKNOWN_DOMAIN;\n    }\n  })();\n\n  return `${FAVICON_BASE_URL}/${domain || UNKNOWN_DOMAIN}.ico`;\n};\n\nexport default getFavicon;\n",
      "type": "registry:lib"
    }
  ]
}
