{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "login-button",
  "type": "registry:block",
  "title": "Login Button",
  "description": "A full-featured login button for Lens Protocol that hooks into the Lens React SDK, uses ConnectKit for wallet connections, supports account switching and more.",
  "dependencies": ["@lens-protocol/react@0.0.0-canary-20250721180328", "connectkit@1.9.0", "react-virtuoso@4.13.0"],
  "registryDependencies": ["avatar", "button", "dialog", "scroll-area", "skeleton"],
  "files": [
    {
      "path": "registry/new-york/blocks/login-button/components/login-button.tsx",
      "content": "\"use client\";\n\nimport {\n    Account,\n    AccountAvailable,\n    AuthenticatedUser,\n    EnvironmentConfig,\n    LoginError,\n    PageSize,\n    PublicClient,\n    UnexpectedError,\n    testnet,\n    evmAddress,\n    useAuthenticatedUser,\n    useLogin,\n    useSwitchAccount,\n} from '@lens-protocol/react'\nimport {fetchAccountsAvailable, lastLoggedInAccount} from '@lens-protocol/client/actions'\nimport {useModal} from 'connectkit'\nimport {useAccount, useWalletClient} from 'wagmi'\nimport {useEffect, useState} from 'react'\nimport config from '@/lib/lens/config'\nimport {Button} from '@/registry/new-york/ui/button'\n\ntype LoginButtonProps = {\n    /**\n     * Called when there are multiple accounts available for the connected wallet. When the wallet is connected,\n     * all available accounts are fetched and if there is only one account available, it is automatically selected.\n     * Otherwise, this function is called to show a modal or UI component that allows the user to select an account.\n     * Once an account is selected, the `selectedAccount` prop should be updated with the chosen account.\n     */\n    onShowAccountPicker: () => void;\n\n    /**\n     * The account that should be used to complete log in. See `onShowAccountPicker` for more details.\n     */\n    selectedAccount: Account | null;\n\n    /**\n     * The environment configuration for the Lens client.\n     * Defaults to testnet if not provided.\n     */\n    environment?: EnvironmentConfig;\n\n    /**\n     * The address of the app that is logging in.\n     * This is optional and can be used to specify the app address.\n     */\n    appAddress?: string;\n\n    /**\n     * Callback function that is called when the user successfully logs in.\n     * It receives the authenticated user as an argument.\n     */\n    onSuccess?: (authenticatedUser: AuthenticatedUser) => void;\n\n    /**\n     * Callback function that is called when there is an error during login.\n     * It receives the error as an argument.\n     */\n    onError?: (error: LoginError) => void;\n}\n\nexport function LoginButton(props: LoginButtonProps) {\n    const [selectedAccount, setSelectedAccount] = useState<Account | null>(props.selectedAccount);\n\n    const { setOpen: setConnectModalOpen, open: modalOpen } = useModal();\n    const { address: walletAddress, isConnected, isConnecting, isReconnecting, isDisconnected } = useAccount();\n    const { data: walletClient } = useWalletClient({ chainId: config.lens.chain.id });\n\n    const { execute: executeLogin, loading: loginLoading, error: loginError } = useLogin();\n    const { data: authenticatedUser, loading: authenticatedUserLoading } = useAuthenticatedUser();\n    const { execute: switchAccount } = useSwitchAccount();\n\n    const { onShowAccountPicker, appAddress, onSuccess, onError, environment = testnet } = props;\n\n    const lensClient = PublicClient.create({ environment });\n\n    useEffect(() => {\n        if (props.selectedAccount) {\n            setSelectedAccount(props.selectedAccount);\n        }\n    }, [props.selectedAccount]);\n\n    useEffect(() => {\n        if (loginError) {\n            onError?.(loginError);\n        }\n    }, [loginError, onError]);\n\n    const getLastLoggedInAccount = async (walletAddress: string) => {\n        const res = await lastLoggedInAccount(lensClient, {\n            address: evmAddress(walletAddress),\n        })\n        if (res.isErr()) {\n            return null;\n        }\n        return res.value;\n    };\n\n    const getAccountsAvailable = async (walletAddress: string): Promise<AccountAvailable[]> => {\n        const res = await fetchAccountsAvailable(lensClient, {\n            managedBy: evmAddress(walletAddress),\n            pageSize: PageSize.Ten,\n        });\n\n        if (res.isErr()) {\n            return [];\n        }\n\n        return [...res.value.items];\n    };\n\n    useEffect(() => {\n        if (authenticatedUser?.address || authenticatedUserLoading || !walletClient) return;\n\n        const walletAddress = walletClient.account.address;\n\n        const fetchData = async () => {\n            const lastAccount = await getLastLoggedInAccount(walletAddress);\n            if (lastAccount) {\n                await login(lastAccount);\n                return;\n            }\n\n            const accounts = await getAccountsAvailable(walletAddress);\n            if (accounts.length === 1) {\n                await login(accounts[0]!.account);\n            } else {\n                onShowAccountPicker();\n            }\n        };\n\n        fetchData().catch(error => {\n            onError?.(new UnexpectedError(\"Error fetching account data for connected wallet\", error));\n        });\n    }, [walletClient, authenticatedUser?.address, authenticatedUserLoading]);\n\n    const login = async (account: Account) => {\n        if (!walletClient) {\n            onError?.(new UnexpectedError(\"Wallet client is not available\"));\n            return;\n        }\n\n        // First attempt to switch accounts, in case of an active session\n        const switchResult = await switchAccount({\n            account: account.address,\n        });\n        if (switchResult.isOk()) {\n            onSuccess?.(switchResult.value);\n            setConnectModalOpen(false);\n            return;\n        }\n\n        const walletAddress = walletClient.account.address;\n\n        const res = await executeLogin({\n            ...(account.owner === walletAddress\n                ? {\n                    accountOwner: {\n                        owner: evmAddress(walletAddress),\n                        account: evmAddress(account.address),\n                        ...(appAddress && {\n                            app: evmAddress(appAddress),\n                        })\n                    },\n                }\n                : {\n                    accountManager: {\n                        manager: evmAddress(walletAddress),\n                        account: evmAddress(account.address),\n                        ...(appAddress && {\n                            app: evmAddress(appAddress),\n                        })\n                    },\n                }),\n            signMessage: async (message: string) => {\n                return walletClient.signMessage({ account: walletAddress, message });\n            },\n        });\n\n        if (res.isErr()) {\n            onError?.(res.error);\n            return;\n        }\n\n        onSuccess?.(res.value);\n        setConnectModalOpen(false);\n    }\n\n    useEffect(() => {\n        if (authenticatedUser?.address || authenticatedUserLoading || loginLoading || !walletClient || !selectedAccount) return\n        login(selectedAccount).catch((error) => onError?.(new UnexpectedError(error)));\n        setSelectedAccount(null);\n    }, [authenticatedUser?.address, authenticatedUserLoading, walletClient, selectedAccount, loginLoading])\n\n    const onLoginButtonClick = () => {\n        if (isConnected && !authenticatedUser) {\n            onShowAccountPicker();\n        } else {\n            setConnectModalOpen(true);\n        }\n    }\n\n    return <Button onClick={onLoginButtonClick}>\n        <svg fill=\"none\" viewBox=\"0 0 64 64\" className=\"text-background\">\n            <path\n                fillRule=\"evenodd\"\n                d=\"M42.311 23.793c1.788-1.654 4.133-2.68 6.745-2.68 5.807.002 10.51 4.71 10.51 10.521 0 5.027-4.973 9.326-6.217 10.316-5.815 4.63-13.39 7.339-21.566 7.339-8.176 0-15.749-2.707-21.565-7.34C8.98 40.96 4 36.653 4 31.634c0-5.811 4.705-10.521 10.507-10.521 2.615 0 4.96 1.026 6.748 2.68l.185-.092c.408-5.422 4.817-9.7 10.343-9.7 5.527 0 9.935 4.278 10.344 9.7l.184.091v.002\"\n                clipRule=\"evenodd\"\n                fill=\"currentColor\"\n            />\n        </svg>\n        <span>Log in with Lens</span>\n    </Button>\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/new-york/blocks/login-button/components/account-chooser.tsx",
      "content": "\"use client\";\n\nimport {Account, Cursor, evmAddress, PageSize, useAccountsAvailable} from '@lens-protocol/react'\nimport {useState} from 'react'\nimport PaginatedList from '@/registry/new-york/blocks/login-button/lib/paginated-list'\nimport {LensAccountListItem} from '@/registry/new-york/blocks/login-button/components/lens-account-list-item'\n\ntype AccountSelectorProps = {\n  walletAddress: string;\n  setSelectedAccount: (account: Account) => void;\n}\n\nexport const AccountChooser = ({ walletAddress, setSelectedAccount }: AccountSelectorProps) => {\n  const [cursor, setCursor] = useState<Cursor | null>(null);\n\n  const { data, loading, error } = useAccountsAvailable({\n    managedBy: evmAddress(walletAddress),\n    pageSize: PageSize.Fifty,\n    cursor,\n  });\n\n  return (\n      <PaginatedList\n          data={data}\n          loading={loading}\n          error={error}\n          cursor={cursor}\n          setCursor={setCursor}\n          emptyMessage='No accounts available'\n          errorMessage='Error loading accounts'\n          renderItem={item => (\n              <LensAccountListItem\n                  account={item.account}\n                  onAccountSelected={setSelectedAccount}\n                  key={item.account.address}\n              />\n          )}\n      />\n  );\n}",
      "type": "registry:component"
    },
    {
      "path": "registry/new-york/blocks/login-button/components/lens-account-list-item.tsx",
      "content": "import {Account} from '@lens-protocol/react'\n\ntype LensAccountListItemProps = {\n    account: Account;\n    onAccountSelected: (account: Account) => void;\n}\n\nexport function LensAccountListItem({ account, onAccountSelected }: LensAccountListItemProps) {\n    return <div onClick={() => onAccountSelected(account)}>{account.address}</div>;\n}",
      "type": "registry:component"
    },
    {
      "path": "registry/new-york/blocks/login-button/hooks/use-authenticated-lens-account.ts",
      "content": "import {useAccount, useAuthenticatedUser} from '@lens-protocol/react'\n\nexport function useAuthenticatedLensAccount() {\n    const { data: authenticatedUser, loading: authenticatedUserLoading } = useAuthenticatedUser();\n\n    const { data: account, loading: accountLoading, error: accountError } = useAccount({\n        address: authenticatedUser?.address,\n    })\n\n    return {\n        loading: authenticatedUserLoading || accountLoading,\n        data: account,\n        error: accountError,\n    };\n}",
      "type": "registry:hook"
    }
  ]
}
